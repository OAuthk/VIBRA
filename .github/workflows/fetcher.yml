name: Fetch and Cache Trend Data

on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'scripts/**'
      - 'models.py'
      - 'requirements.txt'
      - '.github/workflows/fetcher.yml'

jobs:
  fetch-and-cache:
    runs-on: ubuntu-latest
    # Dockerã‚³ãƒ³ãƒ†ãƒŠã®åˆ©ç”¨ã¯ç¶­æŒ
    container:
      image: mcr.microsoft.com/playwright/python:v1.44.0-jammy

    steps:
      - name: Checkout main branch for scripts
        uses: actions/checkout@v4
      
      # â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
      # â˜… å¤‰æ›´ç‚¹ â˜…
      # â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
      - name: ğŸ“¦ Install All Dependencies using Container's Pip
        # Dockerã‚³ãƒ³ãƒ†ãƒŠã«ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹pipã‚’ä½¿ã„ã€
        # æˆ‘ã€…ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
        # ã“ã‚Œã«ã‚ˆã‚Šã€Playwrightã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ã‚‚ã®ã¨ä¸€è‡´ã™ã‚‹ã€‚
        run: pip install -r requirements.txt

      - name: ğŸ“¥ Restore scores cache
        id: scores-cache-restore
        uses: actions/cache/restore@v4
        with:
          path: cache/previous_scores.json
          key: scores-cache-v1

      - name: ğŸ Run Data Pipeline
        env:
          MERCARI_AFFILIATE_ID: ${{ secrets.MERCARI_AFFILIATE_ID }}
          GA4_TRACKING_ID: ${{ secrets.GA4_TRACKING_ID }}
        run: python scripts/main.py

      # ... (ä»¥é™ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜ã¨Gitãƒ—ãƒƒã‚·ãƒ¥ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯å¤‰æ›´ãªã—)
      - name: ğŸ’¾ Save current scores to cache for next run
        # ...
      - name: ğŸš€ Commit and Push data to cache-branch
        # ...